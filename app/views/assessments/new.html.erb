<%= render "shared/vulnerable-banner" %>

<div class="with-left-sidebar">

  <aside class="with-left-sidebar__left">
    <header class="panel-header">
      <h2 class="panel-header__title">Profile</h2>
    </header>
    <div class="panel panel--unpadded">
      <%= render "shared/profile-accordion" %>
    </div>
  </aside>

  <aside class="with-left-sidebar__right">
    <header class="panel-header">
      <h2 class="panel-header__title">Assessments</h2>
    </header>
    <div class="panel panel--unpadded panel--stroked need--phone-triage">
      <%= link_to "#{@type.humanize} an assessment", contact_path(@contact.id), class: "panel__header" %>
      <div class="panel__body">
        <%= form_for @need do |form| %>

          <div class="need-actions">
            <div class="need-actions__field" id="assigned-actions__field">
              <%= form.label :user_id, 'Assigned to', class: 'need-actions__label' %>
              <%= form.collection_select :user_id, @users, :id, :name_or_email, {include_blank: "Unassigned"}, {class: "need-actions__select"} %>
            </div>

            <div class="need-actions__field" id="teams-actions__field">
              <%= form.label :user_id, 'Team', class: 'need-actions__label' %>
              <%= form.collection_select :role_id, @roles, :id, :name, {include_blank: "Unassigned"}, {class: "need-actions__select"} %>
            </div>

            <div class="need-actions__field" id="priority-actions__field">
              <%= form.label :is_urgent, 'Priority', class: 'need-actions__label' %>
              <%= form.select :is_urgent, {
                  "Urgent" => true,
                  "Normal" => false
              }, {}, {class: @need.is_urgent ? "need-actions__select need-actions__select--red" : "need-actions__select"} %>
            </div>

            <div class="need-actions__field" id="status-actions__field">
              <%= form.label :status, 'Status', class: 'need-actions__label' %>
              <%= form.select :status, need_statuses, {}, {class: "need-actions__select"} %>
            </div>
          </div>

          <dl class="details-list">
            <dt class="details-list__caption">Assessment Type</dt>
            <div class="radio">
              <%= form.radio_button :category, 'phone triage', {:checked => @need[:category] == 'phone triage'} %>
              <%= form.label :category_phone_triage, "Phone Triage", class: "radio__label" %>
            </div>
            <div class="radio">
              <%= form.radio_button :category, 'check in', {:checked => @need[:category] == 'check in'} %>
              <%= form.label :category_check_in, "Check In", class: "radio__label" %>
            </div>
          </dl>
          <br/>

          <% if @type == 'log' %>
            <%= form.fields_for @need.notes[0] do |notes_fields| %>
              <%= notes_fields.text_field :body, :placeholder => 'Call notes' %>
            <% end %>

            <% elsif @type == 'schedule' %>
            <%= form.label :start_on, "When should the call be scheduled for?", class: "field__label" %>
            <%= form.text_field :start_on %>
          <% end %>

        <% end %>
      </div>
    </div>
  </aside>

</div>


<%= javascript_pack_tag 'users_viewing_page.js' %>