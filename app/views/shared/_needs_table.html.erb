<%= form_with(url: needs_url, method: :get) do %>
  <table class="table needs-table">
    <tfoot>
    <tr>
      <th>
        <%= select_tag("user_id", options_from_collection_for_select(@users, :id, :name_or_email, :selected => get_param_capitalized('user_id')), prompt: 'Select a user') %>
      </th>
      <th>
        <!-- has to be empty -->
      </th>
      <th>
        <!-- has to be empty -->
      </th>
      <th>
        <%= select_tag("status", options_for_select(need_statuses, :selected => get_param_capitalized('status')), prompt: 'Select a status') %>
      </th>
      <th>
        <!-- has to be empty -->
      </th>
      <th>
        <%= select_tag("category", options_for_select(need_categories, :selected => get_param_capitalized('category')), prompt: 'Select a category') %>
      </th>
      <th>
        <!-- has to be empty -->
      </th>
    </tr>
    </tfoot>
  </table>
  <%= submit_tag("Search") %>
<% end %>
<br/>

<table class="table data-table">
  <thead>
  <tr>
    <th>Assigned to</th>
    <th>Person</th>
    <th>Need</th>
    <th>Status</th>
    <th>Vulnerable</th>
    <th>Category</th>
    <th>Date logged</th>
  </tr>
  </thead>
  <tbody>
  <% needs.each do |need| %>
    <tr>
      <% if need.user %>
        <td><%= need.user_name %></td>
      <% else %>
        <td>Unassigned</td>
      <% end %>
      <td><%= link_to(need.contact_name, contact_path(need.contact.id)) %></td>
      <td><strong><%= link_to need.name, need %></strong></td>
      <td><%= status(need.completed_on) %></td>
      <td>
        <% if need.contact_is_vulnerable %>
          <%= image_tag "red-tick.svg", alt: "vulnerable" %>
        <% else %>
          â€”
        <% end %>
      </td>
      <td><%= need.category %>
      <td><%= format_datetime(need.created_at) %></td>
    </tr>
  <% end %>
  </tbody>
</table>

<%= paginate(@needs) %>