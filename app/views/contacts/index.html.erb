<% if notice %>
  <p class="notice"><%= notice %></p>
<% end %>

<div class="page-header">
  <h1 class="page-title">People in need</h1>
</div>

<% if params[:search] %>
  <div class="filtered-notice notice">
    Showing <%= pluralize(@contacts.size, 'result') %>
    for <strong><%= params[:search] %></strong>.
    <%= link_to 'Clear search', contacts_path %>.
  </div>
<% end %>

<details class="filters">
  <summary class="filters__summary">Search</summary>
  <%= form_with(url: contacts_url, method: :get, local: true) do %>
    <table class="table needs-table">
      <tfoot>
      <tr>
        <div class="field">
          <%= label_tag :search, 'Search by name or postcode', class: 'field__label' %>
          <%= text_field_tag :search, params[:search] %>
        </div>
      </tr>
      </tfoot>
    </table>
    <%= button_tag 'Search', type: 'submit', name: nil %>
  <% end %>
</details>


<div class="table-holder">
  <table class="table">
    <thead>
      <tr>
        <th>Name</th>
        <th>Needs</th>
        <th>Vulnerable</th>
        <th>Date logged</th>
        <th></th>
        <th></th>
      </tr>
    </thead>

    <tbody>
    <% @contacts.each do |contact| %>
      <tr>
        <td><strong><%= link_to contact.name, contact %></strong></td>
        <td>
          <% if contact.needs_count > 0 %>
            <%= pluralize(contact.uncompleted_needs_count, 'need') %>
            <% if contact.completed_needs_count > 0 %>
              <small>(<%= contact.completed_needs_count %> completed)</small>
            <% end %>
          <% end %>
        </td>
        <td>
          <% if contact.is_vulnerable? %>
            <%= image_tag "red-tick.svg", alt: "vulnerable" %>
          <% else %>
            â€”
          <% end %>
        </td>
        <td><%= contact.created_at.strftime("%-d %B %Y %k:%M%P") %></td>
      </tr>
    <% end%>
    </tbody>
  </table>
</div>

<%= paginate @contacts %>
