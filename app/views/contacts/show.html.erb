<%= render "shared/vulnerable-banner" %>

<div id="lead-service-panel" >
  <%= render partial: 'shared/lead_service_panel', locals: { contact: @contact, teams_options: @teams_options} %>
</div>

<div class="with-left-sidebar">
  <aside class="with-left-sidebar__left">
    <header class="panel-header">
      <h2 class="panel-header__title">Profile</h2>
    </header>
    <div class="panel panel--unpadded">  
      <%= render "shared/profile-accordion" %>
    </div>
  </aside>

  <aside class="with-left-sidebar__right">
    <header class="panel-header" id="needs-panel">
      <h2 class="panel-header__title">Support Actions</h2>
      <% if @open_needs.any? %>
        <span class="panel-header__badge"><%= @open_needs.count %></span>
      <% end %>
      <%= link_to "Add support action +", contact_triage_path(@contact), class: "btn-triage" %>
    </header>
    <div class="panel panel--unpadded">  
      <%= render "needs-table" %>
    </div>

    <% if @completed_needs.any? %>
      <div class="panel panel--unpadded">
        <table class="completed-needs-table-nav-show">
          <tbody>
            <tr id="toggle-visibility-completed-needs" class="need--financial-support">
              <td>
                <b><%= pluralize(@completed_needs.count, 'x completed need') %></b>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="panel panel--unpadded">
        <%= render "completed-needs" %>
      </div>
    <% end %>

    <header class="panel-header" id="needs-panel">
      <% if policy(Need).create? %>
        <div class="assessment-operations left">
          <% Need::ASSESSMENT_CATEGORIES.each do |category| %>
            <div class="checkbox">
              <%= check_box_tag("#{category}", nil, false, { class: "checkbox__input"}) %>
              <%= label_tag "#{category}", "#{category.titleize}", class: 'checkbox__label' %>
            </div>
          <% end %>
        </div>
        <div class="assessment-operations right">
          <div class="assessment-dropdown">
            <button id="btnAssessmentDropdown">Add check-in call +</button>
            <div id="assessmentDropdownElements" class="assessment-dropdown-content">
              <%= link_to('Schedule an assessment', new_contact_assessment_path(@contact.id, :type => 'schedule'), id: 'schedule-assesment-btn') %>
              <%= link_to('Log an assessment', new_contact_assessment_path(@contact.id, :type => 'log'), id: 'log-assesment-btn') %>
            </div>
          </div>
          <noscript>
            <ul style="list-style-type: none" id="schedule_an_assessment">
            <li><%= link_to('Schedule an assessment', new_contact_assessment_path(@contact.id, :type => 'schedule'), id: 'schedule-assesment-nojs-btn') %></li>
            <li><%= link_to('Log an assessment', new_contact_assessment_path(@contact.id, :type => 'log'), id: 'log-assesment-nojs-btn') %></li>
          </ul>
          </noscript>


        </div>
      <% end %>
    </header>
    <div class="panel panel--unpadded">
      <%= render "assessments" %>
    </div>
    <div class="panel panel--unpadded">
      <table class="completed-needs-table-nav-show">
        <tbody>
          <tr id="toggle-visibility-completed-assessments" class="need--financial-support">
            <td>
              <b><%= pluralize(@completed_assessments.count, 'x completed assessment') %></b>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </aside>
</div>
<%= javascript_pack_tag 'assessments' %>
<%= javascript_pack_tag 'completed-needs' %>